This project tries to measure the latency of S3 triggered events into SQS. You will need a haskell toolchain, docker, terraform and AWS credentials to get started.

At the beginning of the session, run `terraform init` and then `terraform apply` to create the S3 bucket and SQS queue.

Run `make postgres` in the background to get a database running.

To get results, run `make stats`. You can edit the `config` found in the first few lines of `Main.hs` to try different configurations.

At the end of the session, run `terraform destroy` to clean up.

Some sample results:

```
Config {
    uploadConcurrency = 10,
    sqsConcurrency = 2,
    fileSize = 0,
    totalFiles = 1000
}

 bucket |     range     | freq |              bar               
--------+---------------+------+--------------------------------
      1 | [956,2071)    |   72 | ■■■■■■■■■■■■■■■■■■■■■■■
      2 | [2083,3171)   |   65 | ■■■■■■■■■■■■■■■■■■■■■
      3 | [3194,4302)   |   71 | ■■■■■■■■■■■■■■■■■■■■■■■
      4 | [4314,5406)   |   73 | ■■■■■■■■■■■■■■■■■■■■■■■■
      5 | [5447,6534)   |   73 | ■■■■■■■■■■■■■■■■■■■■■■■■
      6 | [6543,7633)   |   61 | ■■■■■■■■■■■■■■■■■■■■
      7 | [7660,8729)   |   92 | ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
      8 | [8789,9892)   |   69 | ■■■■■■■■■■■■■■■■■■■■■■
      9 | [9907,11004)  |   52 | ■■■■■■■■■■■■■■■■■
     10 | [11025,12103) |   46 | ■■■■■■■■■■■■■■■
     11 | [12146,13240) |   80 | ■■■■■■■■■■■■■■■■■■■■■■■■■■
     12 | [13268,14351) |   62 | ■■■■■■■■■■■■■■■■■■■■
     13 | [14365,15445) |   58 | ■■■■■■■■■■■■■■■■■■■
     14 | [15544,16566) |   49 | ■■■■■■■■■■■■■■■■
     15 | [16609,17603) |   76 | ■■■■■■■■■■■■■■■■■■■■■■■■■
     16 | [17710,17711) |    1 | 

Config {
    uploadConcurrency = 10,
    sqsConcurrency = 10,
    fileSize = 0,
    totalFiles = 1000
}

bucket |    range    | freq |              bar               
--------+-------------+------+--------------------------------
      1 | [471,679)   |   29 | ■■■■■
      2 | [745,911)   |    7 | ■
      3 | [1018,1231) |   28 | ■■■■■
      4 | [1236,1484) |   78 | ■■■■■■■■■■■■■
      5 | [1486,1733) |  104 | ■■■■■■■■■■■■■■■■■
      6 | [1741,1993) |  143 | ■■■■■■■■■■■■■■■■■■■■■■■
      7 | [1996,2246) |  148 | ■■■■■■■■■■■■■■■■■■■■■■■■
      8 | [2247,2500) |  185 | ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
      9 | [2501,2750) |  112 | ■■■■■■■■■■■■■■■■■■
     10 | [2762,2995) |   54 | ■■■■■■■■■
     11 | [3014,3255) |   56 | ■■■■■■■■■
     12 | [3291,3466) |   23 | ■■■■
     13 | [3516,3740) |   15 | ■■
     14 | [3767,3992) |   15 | ■■
     15 | [4108,4164) |    2 | 
     16 | [4274,4275) |    1 | 

Config {
    uploadConcurrency = 10,
    sqsConcurrency = 15,
    fileSize = 0,
    totalFiles = 1000
}

bucket |    range    | freq |              bar               
--------+-------------+------+--------------------------------
      1 | [482,628)   |   17 | ■■■
      2 | [629,771)   |   36 | ■■■■■■■
      3 | [773,916)   |   66 | ■■■■■■■■■■■■
      4 | [918,1063)  |   79 | ■■■■■■■■■■■■■■■
      5 | [1064,1208) |   86 | ■■■■■■■■■■■■■■■■
      6 | [1208,1352) |  112 | ■■■■■■■■■■■■■■■■■■■■■
      7 | [1356,1499) |  125 | ■■■■■■■■■■■■■■■■■■■■■■■■
      8 | [1499,1644) |  146 | ■■■■■■■■■■■■■■■■■■■■■■■■■■■■
      9 | [1644,1788) |  159 | ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
     10 | [1789,1934) |   92 | ■■■■■■■■■■■■■■■■■
     11 | [1934,2077) |   38 | ■■■■■■■
     12 | [2093,2195) |   27 | ■■■■■
     13 | [2226,2350) |   12 | ■■
     14 | [2391,2468) |    4 | ■
     16 | [2660,2661) |    1 | 

Config {
    uploadConcurrency = 10,
    sqsConcurrency = 20,
    fileSize = 0,
    totalFiles = 1000
}

bucket |    range    | freq |              bar               
--------+-------------+------+--------------------------------
      1 | [546,670)   |   10 | ■■
      2 | [674,793)   |   35 | ■■■■■■■
      3 | [798,917)   |   49 | ■■■■■■■■■■
      4 | [920,1043)  |   97 | ■■■■■■■■■■■■■■■■■■■■
      5 | [1043,1167) |  112 | ■■■■■■■■■■■■■■■■■■■■■■■
      6 | [1167,1291) |  143 | ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
      7 | [1292,1414) |  130 | ■■■■■■■■■■■■■■■■■■■■■■■■■■■
      8 | [1416,1540) |  111 | ■■■■■■■■■■■■■■■■■■■■■■■
      9 | [1540,1663) |  135 | ■■■■■■■■■■■■■■■■■■■■■■■■■■■■
     10 | [1666,1786) |   90 | ■■■■■■■■■■■■■■■■■■■
     11 | [1789,1911) |   45 | ■■■■■■■■■
     12 | [1915,2036) |   19 | ■■■■
     13 | [2036,2154) |   15 | ■■■
     14 | [2162,2275) |    6 | ■
     15 | [2325,2374) |    2 | 
     16 | [2408,2409) |    1 | 

Config {
    uploadConcurrency = 10,
    sqsConcurrency = 25,
    fileSize = 0,
    totalFiles = 1000
}

 bucket |    range    | freq |              bar               
--------+-------------+------+--------------------------------
      1 | [474,607)   |   10 | ■■
      2 | [634,743)   |   36 | ■■■■■■■■
      3 | [746,879)   |   79 | ■■■■■■■■■■■■■■■■■
      4 | [882,1015)  |   78 | ■■■■■■■■■■■■■■■■■
      5 | [1016,1150) |  128 | ■■■■■■■■■■■■■■■■■■■■■■■■■■■■
      6 | [1151,1283) |  139 | ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
      7 | [1286,1416) |  136 | ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
      8 | [1425,1555) |  121 | ■■■■■■■■■■■■■■■■■■■■■■■■■■
      9 | [1558,1692) |  111 | ■■■■■■■■■■■■■■■■■■■■■■■■
     10 | [1694,1828) |   80 | ■■■■■■■■■■■■■■■■■
     11 | [1832,1963) |   48 | ■■■■■■■■■■
     12 | [1964,2092) |   21 | ■■■■■
     13 | [2110,2211) |   10 | ■■
     14 | [2237,2318) |    2 | 
     16 | [2504,2505) |    1 | 

Config {
    uploadConcurrency = 10,
    sqsConcurrency = 30,
    fileSize = 0,
    totalFiles = 1000
}

 bucket |    range    | freq |              bar               
--------+-------------+------+--------------------------------
      1 | [445,562)   |   24 | ■■■■■
      2 | [573,680)   |   27 | ■■■■■■
      3 | [698,819)   |   26 | ■■■■■■
      4 | [821,942)   |   40 | ■■■■■■■■■
      5 | [949,1071)  |   71 | ■■■■■■■■■■■■■■■■
      6 | [1071,1195) |  117 | ■■■■■■■■■■■■■■■■■■■■■■■■■■
      7 | [1197,1322) |  133 | ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
      8 | [1323,1447) |  136 | ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
      9 | [1447,1572) |  124 | ■■■■■■■■■■■■■■■■■■■■■■■■■■■
     10 | [1572,1695) |  110 | ■■■■■■■■■■■■■■■■■■■■■■■■
     11 | [1698,1823) |  102 | ■■■■■■■■■■■■■■■■■■■■■■
     12 | [1824,1944) |   53 | ■■■■■■■■■■■■
     13 | [1948,2067) |   28 | ■■■■■■
     14 | [2077,2161) |    7 | ■■
     15 | [2249,2250) |    1 | 
     16 | [2323,2324) |    1 | 

```

